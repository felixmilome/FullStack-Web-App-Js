{"ast":null,"code":"var _jsxFileName = \"/Users/Zoorura/Documents/Projects/Zoorura/zoorura-webClient/src/components/Modals/ContactMod.jsx\",\n    _s = $RefreshSig$();\n\nimport { PhoneIcon, VideoCameraIcon, XCircleIcon } from \"@heroicons/react/outline\";\nimport ReceivedBubble from \"./ReceivedBubble.jsx\";\nimport SentBubble from \"./SentBubble.jsx\";\nimport { BeatLoader } from \"react-spinners\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { MdSend } from \"react-icons/md\";\nimport { useState, useRef, useEffect } from 'react';\nimport { postMessagesAction, getMessagesAction } from '../Midwares/rdx/actions/messagesAction.js';\nimport { postNotificationsAction } from '../Midwares/rdx/actions/notificationsAction.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction ContactMod({\n  setpopChatBox,\n  convoId,\n  displayed,\n  viewer\n}) {\n  _s();\n\n  const [messageData, setmessageData] = useState({\n    convoId: convoId,\n    senderId: viewer._id,\n    receiverId: displayed._id,\n    body: ''\n  });\n  const [online, setOnline] = useState(false);\n  const [checkData, setCheckData] = useState({\n    checkedId: displayed._id,\n    checkerId: viewer._id\n  });\n  const [typingMessageData, setTypingMessageData] = useState({\n    convoId: convoId,\n    senderId: viewer._id,\n    receiverId: displayed._id\n  });\n  const [notificationData, setnotificationData] = useState({\n    sender: viewer._id,\n    receiver: displayed._id,\n    body: '',\n    type: ''\n  });\n  const [socketNotificationData, setsocketNotificationData] = useState({\n    sender: {\n      _id: viewer._id,\n      dpUrl: viewer.dpUrl,\n      userName: viewer.userName\n    },\n    receiver: displayed._id,\n    body: '',\n    type: ''\n  });\n  const [typingNotifier, setTypingNotifier] = useState(false);\n  const dispatch = useDispatch();\n  const diaries = useSelector(state => state.diariesReducer);\n  console.log(diaries);\n  const socket = useSelector(state => state.socketReducer);\n  const messagesAll = useSelector(state => state.messagesReducer); /// THIS ONLY RUNS WHEN NO MESSAGES+++++\n\n  useEffect(() => {\n    const availableMessages = messagesAll.filter(message => message.convoId === convoId);\n\n    if (!availableMessages.length) {\n      console.log(availableMessages);\n      dispatch(getMessagesAction(convoId));\n    }\n  }, [dispatch]); //const messages = useSelector((state) => state.messagesReducer);\n\n  const messages = messagesAll.filter(message => message.convoId === convoId);\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView();\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  useEffect(() => {\n    socket.current.on(\"getMessage\", messageData => {\n      console.log(messageData);\n      console.log(\"Message Gotten\");\n      dispatch({\n        type: 'SOCKET_GOT_MESSAGE',\n        payload: messageData\n      });\n      console.log(messages);\n    });\n  }, []); //  useEffect(() => {\n  //       socket.current.emit(\"checkUserOnline\", {\n  //        checkData\n  //     });\n  //   }, []);\n\n  var intervalId = window.setInterval(function () {\n    socket.current.emit(\"checkUserOnline\", {\n      checkData\n    });\n  }, 20000);\n  useEffect(() => {\n    socket.current.on(\"checkedUserOnline\", checkDataResponse => {\n      console.log(checkDataResponse);\n      console.log(\"User Online\");\n\n      if (checkDataResponse.checkedId === displayed._id) {\n        setOnline(true);\n      }\n    });\n  }, []);\n  useEffect(() => {\n    socket.current.on(\"checkedUserOffline\", checkDataResponse => {\n      console.log(checkDataResponse);\n      console.log(\"User Offline\");\n\n      if (checkDataResponse.checkedId === displayed._id) {\n        setOnline(false);\n      }\n    });\n  }, []);\n  useEffect(() => {\n    socket.current.on(\"getTypingMessage\", typingMessageData => {\n      console.log(typingMessageData);\n      console.log(\"Typing Message Gotten\");\n\n      if (typingMessageData.convoId === convoId && typingNotifier == false) {\n        setTypingNotifier(true);\n        setTimeout(function () {\n          setTypingNotifier(false);\n        }, 5000);\n      }\n    });\n  }, []);\n\n  const notifier = () => {\n    dispatch(postNotificationsAction(notificationData, socketNotificationData, socket));\n  };\n\n  const sendMessage = () => {\n    console.log(messageData);\n    dispatch(postMessagesAction(messageData, socket, notifier));\n    console.log(notificationData); // dispatch(postNotificationsAction(notificationData)); \n\n    setmessageData({ ...messageData,\n      body: ''\n    });\n    setnotificationData({ ...notificationData,\n      body: ''\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"z-20 border-gray-300 fixed top-24 xl:top-20 xl:bottom-0 right-0 xl:right-2 m-auto w-full xl:w-1/4  bg-gray-200\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed z-20  border-b-2 border-gray-200 bg-gray-100 p-1 w-full xl:w-1/4  flex   justify-between items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          wordBreak: 'break-word'\n        },\n        className: \"flex items-center space-x-2 bg-transparent justify-around  p-0.5 px-2 rounded-full  text-xs font-bold  text-gray-500\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: displayed.dpUrl,\n            alt: \"DP\",\n            className: \"rounded-full object-cover h-8 w-8 m-0.5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 25\n          }, this), online === true && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute top-0 right-0 w-3 h-3 justify-center text-white items-center p-1 rounded-full border-2 border-white bg-cyan-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 45\n          }, this), online === false && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute top-0 right-0 w-3 h-3 justify-center text-white items-center p-1 rounded-full border-2 border-white bg-gray-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 46\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"items-center \",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"@\", displayed.userName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 21\n          }, this), typingNotifier && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-cyan-500\",\n            children: \"Typing...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 40\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mx-1 space-x-2 sm:space-x-2 bg-transparent flex items-center justify-around\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"hover:bg-cyan-400 p-1 rounded-full cursor-pointer group\",\n          children: /*#__PURE__*/_jsxDEV(VideoCameraIcon, {\n            className: \"h-6 w-6 group-hover:text-white text-gray-300\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"hover:bg-cyan-400 p-1 rounded-full cursor-pointer group\",\n          children: /*#__PURE__*/_jsxDEV(PhoneIcon, {\n            className: \"h-6 w-6 group-hover:text-white text-gray-300\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: e => setpopChatBox(false),\n          className: \"hover:bg-gray-300 p-1 rounded-full cursor-pointer group\",\n          children: /*#__PURE__*/_jsxDEV(XCircleIcon, {\n            className: \"h-6 w-6 group-hover:text-white text-gray-300\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pb-48 mt-12 max-h-screen min-h-screen w-full overflow-y-scroll\",\n      children: [messages.length ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: messages.map(message => {\n          if (viewer._id === message.senderId) {\n            //BELONGS TO ME(VIEWER)\n            return /*#__PURE__*/_jsxDEV(SentBubble, {\n              SentMessage: message.body\n            }, message._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 37\n            }, this);\n          }\n\n          if (displayed._id === message.senderId) {\n            //BELONGS TO THEM(DISPLAYED)\n            return /*#__PURE__*/_jsxDEV(ReceivedBubble, {\n              ReceivedMessage: message.body\n            }, message._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 37\n            }, this);\n          }\n        })\n      }, void 0, false) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-start p-5\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(BeatLoader, {\n            size: 15,\n            color: \"white\",\n            loading: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-400\",\n            children: \"fetching messages..\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full items-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-end\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \" m-1 p-1 rounded-full flex bg-cyan-200 w-3/4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-2 bg-gray-100 rounded-xl w-full\",\n              children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: messageData.body,\n                onChange: e => {\n                  socket.current.emit(\"sendTypingMessage\", {\n                    typingMessageData\n                  });\n                  socket.current.emit(\"checkUserOnline\", {\n                    checkData\n                  });\n                  setmessageData({ ...messageData,\n                    body: e.target.value\n                  });\n                  setnotificationData({ ...notificationData,\n                    body: e.target.value,\n                    type: 'message'\n                  });\n                  setsocketNotificationData({ ...socketNotificationData,\n                    body: e.target.value,\n                    type: 'message'\n                  });\n                },\n                type: \"text\",\n                placeholder: \"TYPE MESSAGE HERE...\",\n                className: \" resize-none h-36 max-h-screen w-full m-auto text-gray-700 font-medium outline-none bg-gray-100 text-sm rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 239,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 41\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 37\n          }, this), messageData.body.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-center p-3 text-xs font-bold text-gray-400 \",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex rounded-full items-center justify-center space-x-1 \",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                onClick: sendMessage,\n                className: \"bg-cyan-400 rounded-full p-2\",\n                children: /*#__PURE__*/_jsxDEV(MdSend, {\n                  className: \"text-gray-100 text-white h-6 w-6 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 264,\n                  columnNumber: 53\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 263,\n                columnNumber: 48\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 45\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: messagesEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 42\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 33\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ContactMod, \"8T2EJhnHS4V6LKAG1u5wYiAHwGQ=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector];\n});\n\n_c = ContactMod;\nexport default ContactMod;\n\nvar _c;\n\n$RefreshReg$(_c, \"ContactMod\");","map":{"version":3,"sources":["/Users/Zoorura/Documents/Projects/Zoorura/zoorura-webClient/src/components/Modals/ContactMod.jsx"],"names":["PhoneIcon","VideoCameraIcon","XCircleIcon","ReceivedBubble","SentBubble","BeatLoader","useSelector","useDispatch","MdSend","useState","useRef","useEffect","postMessagesAction","getMessagesAction","postNotificationsAction","ContactMod","setpopChatBox","convoId","displayed","viewer","messageData","setmessageData","senderId","_id","receiverId","body","online","setOnline","checkData","setCheckData","checkedId","checkerId","typingMessageData","setTypingMessageData","notificationData","setnotificationData","sender","receiver","type","socketNotificationData","setsocketNotificationData","dpUrl","userName","typingNotifier","setTypingNotifier","dispatch","diaries","state","diariesReducer","console","log","socket","socketReducer","messagesAll","messagesReducer","availableMessages","filter","message","length","messages","messagesEndRef","scrollToBottom","current","scrollIntoView","on","payload","intervalId","window","setInterval","emit","checkDataResponse","setTimeout","notifier","sendMessage","wordBreak","e","map","target","value"],"mappings":"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","sourcesContent":["import { PhoneIcon, VideoCameraIcon, XCircleIcon } from \"@heroicons/react/outline\"\nimport ReceivedBubble from \"./ReceivedBubble.jsx\"\nimport SentBubble from \"./SentBubble.jsx\";\nimport {BeatLoader} from \"react-spinners\";\nimport {useSelector, useDispatch} from 'react-redux';\nimport { MdSend} from \"react-icons/md\";\nimport {useState, useRef, useEffect} from 'react';\nimport {postMessagesAction, getMessagesAction} from '../Midwares/rdx/actions/messagesAction.js';\nimport {postNotificationsAction} from '../Midwares/rdx/actions/notificationsAction.js';\n\n \nfunction ContactMod({setpopChatBox, convoId, displayed, viewer}) {\n\n    const[messageData, setmessageData] = useState({convoId:convoId, senderId:viewer._id, receiverId:displayed._id, body:''});\n    const[online, setOnline] = useState(false);\n    const[checkData, setCheckData] = useState({checkedId: displayed._id, checkerId: viewer._id});\n     const[typingMessageData, setTypingMessageData] = useState({convoId:convoId, senderId:viewer._id, receiverId:displayed._id});\n    const[notificationData, setnotificationData] = useState({sender:viewer._id, receiver:displayed._id, body:'', type: ''});\n    const[socketNotificationData, setsocketNotificationData] = useState({sender:{_id:viewer._id, dpUrl:viewer.dpUrl, userName:viewer.userName}, receiver:displayed._id, body:'', type: ''});\n     const[typingNotifier, setTypingNotifier] = useState(false);\n    const dispatch = useDispatch(); \n\n    const diaries = useSelector((state) => state.diariesReducer);\n\n    console.log(diaries); \n\n    const socket = useSelector((state) => state.socketReducer);\n\n    const messagesAll = useSelector((state) => state.messagesReducer);\n\n \n    /// THIS ONLY RUNS WHEN NO MESSAGES+++++\n    useEffect(() => { \n        const availableMessages = messagesAll.filter(message => message.convoId === convoId);\n        if(!availableMessages.length){\n            console.log (availableMessages);\n            dispatch(getMessagesAction(convoId));    \n        }\n\n    }, [dispatch]); \n\n    //const messages = useSelector((state) => state.messagesReducer);\n\n     const messages = messagesAll.filter(message => message.convoId === convoId);\n\n    \n\n\n    const messagesEndRef = useRef(null)\n\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView();\n    }\n\n    useEffect(() => {\n        scrollToBottom()\n    }, [messages]);\n\n    useEffect(() => {\n        socket.current.on(\"getMessage\", messageData =>{\n            console.log(messageData);\n            console.log(\"Message Gotten\");\n            dispatch ({type: 'SOCKET_GOT_MESSAGE', payload: messageData});\n            console.log(messages);\n\n        })\n    }, []);\n\n    //  useEffect(() => {\n    //       socket.current.emit(\"checkUserOnline\", {\n    //        checkData\n    //     });\n    //   }, []);\n\n      var intervalId = window.setInterval(function(){\n\n           socket.current.emit(\"checkUserOnline\", {\n           checkData\n        });\n        \n      }, 20000);\n\n      useEffect(() => {\n        socket.current.on(\"checkedUserOnline\", checkDataResponse =>{\n            console.log(checkDataResponse);\n            console.log(\"User Online\");\n\n            if (checkDataResponse.checkedId === displayed._id){\n              setOnline(true);\n            }\n\n        })\n    }, []);\n\n     useEffect(() => {\n        socket.current.on(\"checkedUserOffline\", checkDataResponse =>{\n            console.log(checkDataResponse);\n            console.log(\"User Offline\");\n\n            if (checkDataResponse.checkedId === displayed._id){\n              setOnline(false);\n            }\n\n        })\n    }, []);\n\n   \n    \n     useEffect(() => {\n        socket.current.on(\"getTypingMessage\", typingMessageData =>{\n            console.log(typingMessageData);\n            console.log(\"Typing Message Gotten\");\n\n            if(typingMessageData.convoId === convoId && typingNotifier== false ){\n                \n                setTypingNotifier(true);\n                setTimeout( function() {setTypingNotifier(false)}, 5000);\n                \n            }\n            \n            \n        })\n    }, []);\n \n    const notifier = () =>{\n        dispatch(postNotificationsAction(notificationData, socketNotificationData, socket));\n    }\n  \n    const sendMessage = () => { \n        console.log(messageData); \n        dispatch(postMessagesAction(messageData, socket, notifier));\n        console.log(notificationData);\n       // dispatch(postNotificationsAction(notificationData)); \n        \n        setmessageData({...messageData, body: ''});\n        setnotificationData({...notificationData, body: ''});\n       \n    }\n\n    return (\n        <div className=\"z-20 border-gray-300 fixed top-24 xl:top-20 xl:bottom-0 right-0 xl:right-2 m-auto w-full xl:w-1/4  bg-gray-200\">\n            {/* Top Part */}\n            <div className=\"fixed z-20 \n            border-b-2 border-gray-200\n             bg-gray-100 p-1\n             w-full xl:w-1/4  flex  \n             justify-between items-center\">\n\n                <div style={{wordBreak: 'break-word'}} className=\"flex items-center space-x-2\n                 bg-transparent justify-around \n                 p-0.5 px-2 rounded-full \n                 text-xs\n                  font-bold \n                   text-gray-500\">\n                    <div className='relative'>\n                        <img src={displayed.dpUrl} alt=\"DP\" className=\"rounded-full object-cover h-8 w-8 m-0.5\"/>    \n                         {online ===true && <div className= 'absolute top-0 right-0 w-3 h-3 justify-center text-white items-center p-1 rounded-full border-2 border-white bg-cyan-400'>\n                        {/* dot */}\n                        </div>}\n                         {online ===false && <div className= 'absolute top-0 right-0 w-3 h-3 justify-center text-white items-center p-1 rounded-full border-2 border-white bg-gray-400'>\n                        {/* dot */}\n                        </div>}\n                    </div>\n                    <div className='items-center '>\n                    <p>@{displayed.userName}</p>\n                    {typingNotifier && <p className='text-cyan-500' >Typing...</p>}\n                    </div>\n                    \n                </div>\n                <div className=\"mx-1 space-x-2 sm:space-x-2 bg-transparent flex items-center justify-around\">\n                    <div className=\"hover:bg-cyan-400\n                     p-1 rounded-full cursor-pointer group\">\n                        <VideoCameraIcon className= \"h-6 w-6 group-hover:text-white text-gray-300\"/>\n                    </div>\n                    <div className=\"hover:bg-cyan-400\n                     p-1 rounded-full cursor-pointer group\">\n                        <PhoneIcon className= \"h-6 w-6 group-hover:text-white text-gray-300\"/>\n                    </div>\n                    <div onClick ={(e)=> setpopChatBox(false)} className=\"hover:bg-gray-300\n                     p-1 rounded-full cursor-pointer group\">\n                        <XCircleIcon className= \"h-6 w-6 group-hover:text-white text-gray-300\"/>\n                    </div>\n                </div>\n\n            </div>\n            \n            {/* ALL MESSAGE CHATs CONTAINER */}\n            <div className= \"pb-48 mt-12 max-h-screen min-h-screen w-full overflow-y-scroll\">\n                {/* <ReceivedBubble ReceivedMessage=\"Hello Sir Milome\"/>\n                <SentBubble SentMessage=\"I am Fine\"/>\n                */}\n                {messages.length ?\n\n                    <>\n                        {\n                        messages.map((message) =>{\n                            \n\n                            if (viewer._id === message.senderId){ //BELONGS TO ME(VIEWER)\n                              \n                                return(\n                                    <SentBubble key={message._id} SentMessage={message.body}/>\n                                )\n                            }\n                            if (displayed._id === message.senderId){ //BELONGS TO THEM(DISPLAYED)\n                             \n                                return(\n                                    <ReceivedBubble key={message._id} ReceivedMessage={message.body}/>\n                                )\n                            }\n                        }\n                       \n                        )\n\n                        }     \n                </> :\n\n                        <div className='flex justify-start p-5'>\n                            <div className=''>\n                                <BeatLoader size={15} color='white' loading/>\n                                <p className= 'text-sm text-gray-400'>fetching messages..</p>\n                            </div>\n                        </div>\n                }\n\n                    <div className=\"w-full items-center\">\n                                  {/* <div className='w-full h-8 flex justify-center'>\n                                     {typingNotifier && <div className='flex font-semibold text-gray-500 items-center space-x-1 py-1 px-3  bg-gray-300 rounded-full'>\n                                        <p>{displayed.userName} is Typing</p>\n                                       <BeatLoader size={10} color='white' loading/>\n                                        \n                                    </div>}\n                                  </div> */}\n                                <div className='flex justify-end'>\n                                \n                                    <div className=' m-1 p-1 rounded-full flex bg-cyan-200 w-3/4'>\n                                        <div className='p-2 bg-gray-100 rounded-xl w-full'>\n                                        \n                                        <textarea \n                                        value={messageData.body}\n                                        onChange={(e)=>{\n                                            socket.current.emit(\"sendTypingMessage\", {\n                                                    typingMessageData\n                                                });\n                                                socket.current.emit(\"checkUserOnline\", {\n                                                  checkData\n                                                });\n                                             setmessageData({...messageData, body: e.target.value});\n                                            setnotificationData({...notificationData, body: e.target.value, type:'message'});\n                                            setsocketNotificationData({...socketNotificationData, body: e.target.value, type:'message'});\n                                             }\n                                            }\n                                        type=\"text\" placeholder=\"TYPE MESSAGE HERE...\" className=\" resize-none h-36 max-h-screen w-full m-auto text-gray-700 font-medium outline-none bg-gray-100 text-sm rounded\"/>\n                                    \n                                        </div>\n\n                                    </div>\n                                     { messageData.body.length > 0 && \n                                        <div className='flex justify-center p-3 text-xs font-bold text-gray-400 '>\n                                            \n                                            <div className='flex rounded-full items-center justify-center space-x-1 '>\n                                              \n                                               <div onClick= {sendMessage} className='bg-cyan-400 rounded-full p-2'>\n                                                    <MdSend className='text-gray-100 text-white h-6 w-6 '/>\n                                                </div>\n                                            \n                                            </div>\n                                        </div>\n                                        }\n                                  \n                                         <div ref={messagesEndRef} />\n                                      \n                                </div>\n                                  \n                                \n                    </div>\n\n            </div>\n        </div>\n    )\n}\n\nexport default ContactMod;\n"]},"metadata":{},"sourceType":"module"}